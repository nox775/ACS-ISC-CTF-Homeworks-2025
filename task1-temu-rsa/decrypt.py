from Crypto.Util.number import long_to_bytes, isPrime

# RSA values
n = 12144007859741048335705467836975006941251018087602849948515743492612205139577727274558841577495064010648833912805189983531260723742022670560310690816784631467484141116290214832051879923487627293292159194837351518247376739824687119798844415145845748723377593089260230454418181984911056864524807972421571507999089513016161221769581939785291414636003152871949434388442037084643199197628013759250884601085195653104413080364038308222159234622629339659225965798098911848515383029844685056498450853375573573107507958084961530809113007162344156956787824699370609504251241607192503814774166071458008964892135397107395096898349
e = 65537
dp = 96938334544698397635987388053852484202160864820869701665420780442435644275373986311554525407239927247966338170502151677556924593194688567891775196198676300828315865955526031781763391042512640524603880806849667728205632303765429555616423214973285665304052845090108895514649312319451618405971211862736569234663
c = 9271572348303334526072451539764582601020817323950005789512267392364646416650269166551854376130591398134158955772810138151516713501093385564569544714832660759270415290607289611763377221755682267938392247536101573400967215180210656516272549118394311195127387402699244148145442731536691808938653975265882323080870343062159668081127651146844745266842317840532005599280953715842565644634900608202932527728795118578162300173053687082616935114565107220172419624445771138303060787186796414582303468109715791649703772672783736222377577733757875239800482083410574374103278452220615431016325968911785248835891601005093566406021

# dp este de fapt p
p = dp
if not isPrime(p) or n % p != 0:
    raise Exception("dp nu este p.")

q = n // p
phi = (p - 1) * (q - 1)
d = pow(e, -1, phi)

# RSA decrypt => obtinem ciphertext-ul pentru Vigenère
rsa_output = long_to_bytes(pow(c, d, n)).decode(errors="ignore")


# ----------- VIGENÈRE ------------ #

def vigenere_decrypt(ciphertext, key):
    plaintext = ""
    key_len = len(key)
    key_index = 0
    
    for char in ciphertext:
        if char.isalpha():
            shift = ord(key[key_index % key_len].upper()) - 65
            base = 65 if char.isupper() else 97
            decoded = chr((ord(char) - base - shift) % 26 + base)
            plaintext += decoded
            key_index += 1
        else:
            plaintext += char
    return plaintext

key = "CROISSANT"

# RSA output → Vigenère decrypt
flag = vigenere_decrypt(rsa_output, key)

print("FLAG:", flag)

